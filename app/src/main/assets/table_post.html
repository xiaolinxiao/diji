<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=3.0" />
    <title>压重堆载记录</title>

    <style type="text/css">
        .body{
        background-color:#0099FF;
        color:#ffffff;
        }

        table{border-collapse:collapse;border-spacing:0;border-left:1px solid #fff;border-top:1px solid #fff;}
        th,td{border-right:1px solid #fff;border-bottom:1px solid #fff;padding:1px 1px;}
        th{font-weight:bold;}

        input
        {
        border-left: #fff 1px solid;
        border-top: #fff 1px solid;
        border-right: #fff 1px solid;
        border-bottom: #fff 1px solid;
        margin: 0px 0px 1px 1px;
        padding-left: 5px;
        float: left;
        font-size: 1em;
        line-height: 1.5em;
        text-align: left;
        }

        .checkbox {
        width: 20px;
        height: 20px;
        padding: 5px 5px 5px 5px;
        display: block;
        clear: left;
        float: left;
        vertical-align:text-bottom;
        margin-bottom:2px;
        *margin-bottom:-2px;
        }
    </style>
</head>

<body class="body">
<table onclick="" id="tab">
    <caption>压重堆载记录</caption>
    <tr>
        <th>序号</th>
        <th>压重类型</th>
        <th>尺寸</th>
        <th>单个重量(t)</th>
        <th>数量(个)</th>
        <th>总重量(t)</th>
    </tr>
    <tr>
        <td>1</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(1)"/></td>
    </tr>

    <tr>
        <td>2</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(2)"/></td>
    </tr>

    <!-- onkeydown="onlyNum(this);"  onkeyup="onlyNum(this)" onkeyup="value=value.replace(/[^\-?\d.]/g,'')"-->

    <tr>
        <td>3</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(3)"/></td>
    </tr>

    <tr>
        <td>4</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(4)"/></td>
    </tr>

    <tr>
        <td>5</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(5)"/></td>
    </tr>

    <tr>
        <td>6</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(6)"/></td>
    </tr>

    <tr>
        <td>7</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(7)"/></td>
    </tr>

    <tr>
        <td>8</td>
        <td><input type="text" name="" /></td>
        <td><input type="text" name="" /></td>
        <td><input type="number" name="" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" style="width:50px" onkeydown="onlyNum(this);" onkeyup="onlyNum(this)"/></td>
        <td><input type="number" name="" onClick="count(8)"/></td>
    </tr>

    <tr>
        <td colspan="5">合计</td>
        <td onClick="getSum()"><input type="text" name="" id="total"/></td>
    </tr>

</table>
<br />
<br />
<form name="form1" >
    <font size="4px">不是采用压重平台提供反力</font>
    <input type="checkbox" class="checkbox" name="checkbox" onClick="skipTable(this)"  />
</form>

<script type="text/javascript" >


function getTdValue()
{
var tableId = document.getElementById("tab");
var TableVo= new Array();
//var item={"wtype":"","wsize":"","weight":"","wnumber":"","wsum":""};

for(var i=1;i<tableId.rows.length;i++)
{
    if(i!=9){
    // var Vo=tableId.rows[1].cells[i].childNodes[0].value;
    // item.number = tableId.rows[i].cells[0].innerText;
    // console.log(tableId.rows[i].cells[0].innerText);
    // item.type = tableId.rows[i].cells[1].childNodes[0].value;
    // item.size=tableId.rows[i].cells[2].childNodes[0].value;
    // item.singleWeight=tableId.rows[i].cells[3].childNodes[0].value;
    // item.count=tableId.rows[i].cells[4].childNodes[0].value;
    // item.totalWeight=tableId.rows[i].cells[5].childNodes[0].value;

    //var number = tableId.rows[i].cells[0].innerText;
    var type = tableId.rows[i].cells[1].childNodes[0].value;
    var size=tableId.rows[i].cells[2].childNodes[0].value;
    var singleWeight=tableId.rows[i].cells[3].childNodes[0].value;
    var count=tableId.rows[i].cells[4].childNodes[0].value;
    var totalWeight=tableId.rows[i].cells[5].childNodes[0].value;

  //  isZhengzhengshu  isZhengxiaoshu
    if (singleWeight == "" || isZhengzhengshu(singleWeight) || isZhengxiaoshu(singleWeight)){
 //   	alert("singleWeight======" + singleWeight);
 //   	alert('is a number');
    } else {
    	alert('第' + i + "行 '单个重量' 输入为非法数字，请重新输入");
    	android.resetButton();
    	return;
    }
    if (count == "" || isZhengzhengshu(count)){
    	 //   	alert('is a number');
    	    } else {
    	    	alert('第' + i + "行 '数量' 输入为非法数字，请重新输入");
    	    	android.resetButton();
    	    	return;
    	    }
//    if (!isNaN(singleWeight)){
//    	alert('is a  number');
//    } else {
//    	alert('no a number 第');
//    	return;
//    }

    //console.log("type是"+type);
    if(type!=""||size!=""||singleWeight!=""||count!=""||totalWeight!=""){
     if(type==""||size==""||singleWeight==""||count==""||totalWeight==""){
  //      alert("请保证同一行数据完整" + singleWeight);
  		//不清楚为什么输入类似3.88,88这样的数据后保存后会变成"",所以我改下提示
  		alert('第' + i + '行数据不完整或有错误，请重新输入');
        android.resetButton();
        return;
    	}
    }
    if(type!=""&&size!=""&&singleWeight!=""&&count!=""&&totalWeight!=""){
    	var po=new Item(type,size,singleWeight,count,totalWeight);
    	TableVo.push(po);
    	//console.log(TableVo);
    }

    var str=JSON.stringify(TableVo);
    if(i==8){
        console.log(str);
        android.showData(str);
    	}
    }
}
}

function Item(type,size,singleWeight,count,totalWeight){
    this.wtype = type;
    this.wsize = size;
    this.weight = singleWeight;
    this.wnumber = count;
    this.wsum = totalWeight;
};


  function getSum(){

  var tableId = document.getElementById("tab");
  var sum=0;
  for(var t=1;t<tableId.rows[0].cells.length;t++)
    {
        if(t!=9){
        var single = tableId.rows[t].cells[5].childNodes[0].value;
        if(single!=""){
        sum += parseFloat(single);
        //sum += number;
        }
        }

    }
    console.log(sum);
    document.getElementById("total").value=sum;
}

  function skipTable(para){
      var table= document.getElementById("tab");
      if(para.checked){
         // alert("true");
        android.takePhoto();

      }else{

      }
  }

    function count(line){
    var TableVo= new Array();
    var tableId = document.getElementById("tab");
    for(var i=1;i<tableId.rows.length;i++)
       {
        if(i!=9){
        var type = tableId.rows[i].cells[1].childNodes[0].value;
        var size=tableId.rows[i].cells[2].childNodes[0].value;
        var singleWeight=tableId.rows[i].cells[3].childNodes[0].value;
        var count=tableId.rows[i].cells[4].childNodes[0].value;
        var totalWeight=tableId.rows[i].cells[5].childNodes[0].value;
        var po=new Item(type,size,singleWeight,count,totalWeight);
        TableVo.push(po);
         }
       }
    var single=TableVo[line-1].weight;
    var number=TableVo[line-1].wnumber;
    var sum=0;
    if(single!=""&&number!=""){
        sum = single* number;
       //sum = parseInt(single)* parseInt(number);
       tableId.rows[line].cells[5].childNodes[0].value=sum;
    }

  }

  function onlyNum(obj)
    {

	  //不能够判断多个小数点 test(obj.value);

//	  if(!isNaN(obj.value)){
//		   alert("是数字");
//		}else{
//		   alert("不是数字");
//		  obj.value = "";
//		}

//	  if (checkRate(obj)){
//		  alert('不是数字')
//	  } else {
//		  alert('是数字')
//	  }

	   //先把非数字的都替换掉，除了数字和.
//     obj.value = obj.value.replace(/[^\d.]/g,"");
        //必须保证第一个为数字而不是.
//     obj.value = obj.value.replace(/^\./g,"");
        //保证只有出现一个.而没有多个.    我改了这里，不知道会有效果吗？
 //    obj.value = obj.value.replace(/\.{2,}/g,"");
        //保证.只出现一次，而不能出现两次以上
 //    obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");

 //先把非数字的都替换掉，除了数字和.
  //   obj.value = obj.value.replace(/[^\d.]/g,"");
        //必须保证第一个为数字而不是.
  //   obj.value = obj.value.replace(/^\./g,"");
        //保证只有出现一个.而没有多个.
   //  obj.value = obj.value.replace(/\.{2,}/g,".");
        //保证.只出现一次，而不能出现两次以上
 //    obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
    }

//判断字符串是否为数字
  function checkRate(input)
  {
       var re = /^[0-9]+.?[0-9]*$/;
       if (!re.test(input.rate.value))
      {
          alert("请输入数字(例:0.02)");
          input.rate.focus();
          return false;
       }
  }

  //function test(text){ var reg = /^\d{1,3}(,\d{3})*(\.\d+)?$/; if(reg.test(text)) alert("输入合法"); else alert("请重新输入");}

  function isZhengzhengshu(str) { return /^[1-9]+[0-9]*$/.test(str); };//正整数
  function isZhengxiaoshu(str) { return /^[1-9]+[0-9]*\.[0-9]+$/.test(str) || /^0\.[0-9]+$/.test(str); }//正小数



</script>

</body>

</html>
